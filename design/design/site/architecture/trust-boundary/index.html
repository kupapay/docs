
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<link href="../overview/" rel="prev"/>
<link href="../components/" rel="next"/>
<link href="../../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.6.1, mkdocs-material-9.7.1" name="generator"/>
<title>Trust Boundary - Bono Pay Technical Design</title>
<link href="../../assets/stylesheets/main.484c7ddc.min.css" rel="stylesheet"/>
<link href="../../assets/stylesheets/palette.ab4e12ef.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<link href="../../assets/mermaid-zoom.css" rel="stylesheet"/>
<script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
</head>
<body data-md-color-accent="#3FFF00" data-md-color-primary="#3FFF00" data-md-color-scheme="slate" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#trust-boundary">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header md-header--shadow" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="Bono Pay Technical Design" class="md-header__button md-logo" data-md-component="logo" href="../.." title="Bono Pay Technical Design">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            Bono Pay Technical Design
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Trust Boundary
            
          </span>
</div>
</div>
</div>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="Bono Pay Technical Design" class="md-nav__button md-logo" data-md-component="logo" href="../.." title="Bono Pay Technical Design">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
    Bono Pay Technical Design
  </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../..">
<span class="md-ellipsis">
    
  
    Home
  

    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
<span class="md-ellipsis">
    
  
    Architecture
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_2_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
            
  
    Architecture
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../overview/">
<span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
<span class="md-ellipsis">
    
  
    Trust Boundary
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
<span class="md-ellipsis">
    
  
    Trust Boundary
  

    
  </span>
</a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#what-crosses-the-boundary">
<span class="md-ellipsis">
      
        What crosses the boundary
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#what-the-trusted-zone-produces">
<span class="md-ellipsis">
      
        What the trusted zone produces
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#what-never-crosses-the-boundary">
<span class="md-ellipsis">
      
        What never crosses the boundary
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#failure-modes-at-the-boundary">
<span class="md-ellipsis">
      
        Failure modes at the boundary
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#trust-assumptions-table">
<span class="md-ellipsis">
      
        Trust assumptions table
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#phase-3-note">
<span class="md-ellipsis">
      
        Phase 3 note
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../components/">
<span class="md-ellipsis">
    
  
    Component Map
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../data-flow/">
<span class="md-ellipsis">
    
  
    Data Flow
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
<span class="md-ellipsis">
    
  
    Invoicing Platform
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_3_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
            
  
    Invoicing Platform
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../platform/overview/">
<span class="md-ellipsis">
    
  
    Product Overview
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../platform/api/">
<span class="md-ellipsis">
    
  
    Invoicing API
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../platform/dashboard/">
<span class="md-ellipsis">
    
  
    Web Dashboard
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../platform/sdk/">
<span class="md-ellipsis">
    
  
    SDK &amp; Libraries
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
<span class="md-ellipsis">
    
  
    Fiscal Engine
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
            
  
    Fiscal Engine
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../fiscal/invoice-lifecycle/">
<span class="md-ellipsis">
    
  
    Invoice Lifecycle
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../fiscal/tax-engine/">
<span class="md-ellipsis">
    
  
    Tax Engine (14 Groups)
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../fiscal/security-elements/">
<span class="md-ellipsis">
    
  
    Security Elements
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../fiscal/reports/">
<span class="md-ellipsis">
    
  
    Reports (Z/X/A)
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
<span class="md-ellipsis">
    
  
    Cloud &amp; Sync
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_5">
<span class="md-nav__icon md-icon"></span>
            
  
    Cloud &amp; Sync
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../cloud/architecture/">
<span class="md-ellipsis">
    
  
    Cloud Architecture
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../cloud/offline-sync/">
<span class="md-ellipsis">
    
  
    Offline-First Sync
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../cloud/dgi-integration/">
<span class="md-ellipsis">
    
  
    DGI Integration
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_6" type="checkbox"/>
<label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
<span class="md-ellipsis">
    
  
    Platform &amp; Integrations
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_6_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_6">
<span class="md-nav__icon md-icon"></span>
            
  
    Platform &amp; Integrations
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../platform/multi-user/">
<span class="md-ellipsis">
    
  
    Multi-User Access
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../platform/integrations/">
<span class="md-ellipsis">
    
  
    Integrations
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_7" type="checkbox"/>
<label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
<span class="md-ellipsis">
    
  
    Regulatory
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_7_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_7">
<span class="md-nav__icon md-icon"></span>
            
  
    Regulatory
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../regulatory/legal-framework/">
<span class="md-ellipsis">
    
  
    DRC Legal Framework
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../regulatory/arretes/">
<span class="md-ellipsis">
    
  
    Arrêté Summary
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../regulatory/sfe-specs/">
<span class="md-ellipsis">
    
  
    SFE Specifications
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_8" type="checkbox"/>
<label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
<span class="md-ellipsis">
    
  
    ADRs
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_8_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_8">
<span class="md-nav__icon md-icon"></span>
            
  
    ADRs
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../adr/">
<span class="md-ellipsis">
    
  
    Index
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../adr/adr-0001/">
<span class="md-ellipsis">
    
  
    0001 - Two-Phase Commit
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../adr/adr-0002/">
<span class="md-ellipsis">
    
  
    0002 - Signature Algorithm
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../adr/adr-0003/">
<span class="md-ellipsis">
    
  
    0003 - Platform Technology Stack
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../adr/adr-0004/">
<span class="md-ellipsis">
    
  
    0004 - Cloud Fiscal Signing
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../adr/adr-0005/">
<span class="md-ellipsis">
    
  
    0005 - Strategic Pivot
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_9" type="checkbox"/>
<label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
<span class="md-ellipsis">
    
  
    API Reference
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_9_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_9">
<span class="md-nav__icon md-icon"></span>
            
  
    API Reference
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../api/cloud/">
<span class="md-ellipsis">
    
  
    Cloud API
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../api/invoicing-sdk/">
<span class="md-ellipsis">
    
  
    Invoicing SDK
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_10" type="checkbox"/>
<label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="0">
<span class="md-ellipsis">
    
  
    Implementation
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_10_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_10">
<span class="md-nav__icon md-icon"></span>
            
  
    Implementation
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../implementation/roadmap/">
<span class="md-ellipsis">
    
  
    Roadmap
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../implementation/phase-1/">
<span class="md-ellipsis">
    
  
    Phase 1 - Software Invoicing
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../implementation/phase-2/">
<span class="md-ellipsis">
    
  
    Phase 2 - POS &amp; Retail
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../implementation/phase-3/">
<span class="md-ellipsis">
    
  
    Phase 3 - USB Hardware
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../implementation/phase-4/">
<span class="md-ellipsis">
    
  
    Phase 4 - Enterprise
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#what-crosses-the-boundary">
<span class="md-ellipsis">
      
        What crosses the boundary
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#what-the-trusted-zone-produces">
<span class="md-ellipsis">
      
        What the trusted zone produces
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#what-never-crosses-the-boundary">
<span class="md-ellipsis">
      
        What never crosses the boundary
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#failure-modes-at-the-boundary">
<span class="md-ellipsis">
      
        Failure modes at the boundary
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#trust-assumptions-table">
<span class="md-ellipsis">
      
        Trust assumptions table
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#phase-3-note">
<span class="md-ellipsis">
      
        Phase 3 note
      
    </span>
</a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1 id="trust-boundary">Trust Boundary<a class="headerlink" href="#trust-boundary" title="Permanent link">¶</a></h1>
<p>Bono Pay positions the <strong>Cloud Signing Service (HSM-backed)</strong> as the sole trusted fiscal authority in Phase 1. Web dashboards, API consumers, SDKs, and future POS terminals live in the untrusted zone; they author canonical payloads (<code>merchant_nif</code>, <code>outlet_id</code>, <code>pos_terminal_id</code>, <code>client</code>, <code>tax_groups</code>, <code>totals</code>, <code>payments</code>, <code>timestamp</code>) and deliver them to Bono Pay Cloud for validation, tax calculation, signing, and ledger storage (see <code>spec/architecture-kutapay-system-1.md</code>). Nothing that undermines fiscal integrity is permitted to traverse backward across this boundary.</p>
<h2 id="what-crosses-the-boundary">What crosses the boundary<a class="headerlink" href="#what-crosses-the-boundary" title="Permanent link">¶</a></h2>
<ol>
<li><strong>Canonical invoice requests</strong> — Clients send deterministic JSON through <code>POST /api/v1/invoices</code> (or direct API/SDK calls) that include the 14 DGI tax groups, client classification, outlet/scoping identifiers, and payments in the field order mandated by the spec.</li>
<li><strong>Payment metadata &amp; tracing headers</strong> — Each request carries <code>X-BonoPay-Merchant-ID</code>, <code>X-BonoPay-Outlet-ID</code>, optionally <code>X-BonoPay-User-ID</code>/<code>X-BonoPay-Source</code>, and other telemetry that lets the Cloud scope the Monotonic Counter Manager per outlet.</li>
<li><strong>Retry/queue health updates</strong> — When dashboards or SDKs flush queued invoices after offline intervals, only the canonical payloads, timestamps, and queue metadata travel into the trusted zone so fiscalization can resume safely.</li>
</ol>
<h2 id="what-the-trusted-zone-produces">What the trusted zone produces<a class="headerlink" href="#what-the-trusted-zone-produces" title="Permanent link">¶</a></h2>
<ul>
<li><strong>Sealed responses</strong> — The Cloud Signing Service returns the five mandatory elements (fiscal number, fiscal authority ID, cryptographic auth code, trusted timestamp, QR payload) plus <code>ledger_hash</code>, <code>dgi_status</code>, and the signed payload that clients may display or deliver.</li>
<li><strong>Ledger entries</strong> — The hash-chained Fiscal Ledger records each fiscal event immutably, linking counters, timestamps, and security elements in PostgreSQL with serializable isolation.</li>
<li><strong>DGI upload bundles</strong> — The Sync Agent packages sealed invoices for the DGI (MCF/e-MCF), honoring ack/​retry semantics while never re-signing or mutating the payload.</li>
<li><strong>Audit-ready reports</strong> — The Report Generator emits Z/X/A/audit exports derived from the same ledger entries that produced the sealed invoice.</li>
</ul>
<h2 id="what-never-crosses-the-boundary">What never crosses the boundary<a class="headerlink" href="#what-never-crosses-the-boundary" title="Permanent link">¶</a></h2>
<ul>
<li><strong>Private keys or signing material</strong> — HSM-held keys stay inside the Cloud Signing Service. Clients never see them.</li>
<li><strong>Raw monotonic counters or journal mutations</strong> — Counter increments and journal writes occur only inside the trusted zone. The Cloud enforces serializable isolation to prevent concurrency issues.</li>
<li><strong>Fabricated security elements</strong> — Client applications may only display sealed responses; they cannot invent fiscal numbers, timestamps, auth codes, or QR payloads.</li>
<li><strong>Untrusted reports</strong> — Reports described above come solely from the fiscal ledger; dashboards may read them but may not publish unverified totals.</li>
<li><strong>Internal health controls</strong> — Metrics like <code>counter_health</code> or <code>nonce_pool</code> remain within the trusted services; dashboards only surface sanitized statuses.</li>
</ul>
<pre class="mermaid"><code>flowchart LR
    subgraph "Untrusted Zone (Clients)"
        Dashboard["Web Dashboard (PWA)"]
        API["API Consumers"]
        SDK["SDKs &amp; Integrations"]
        POS["Future POS Terminals"]
    end
    subgraph "Trusted Bono Pay Cloud"
        Signing["Cloud Signing Service (HSM)"]
        Counter["Monotonic Counter Manager"]
        Ledger["Hash-Chained Fiscal Ledger"]
        Reports["Report Generator (Z/X/A)"]
        Sync["DGI Sync Agent"]
    end
    DGI["DGI (MCF/e-MCF)"]
    Dashboard --&gt;|canonical invoice / POST /api/v1/invoices| Signing
    API --&gt;|canonical invoice / POST /api/v1/invoices| Signing
    SDK --&gt;|canonical invoice / POST /api/v1/invoices| Signing
    POS --&gt;|canonical invoice / POST /api/v1/invoices| Signing
    Signing --&gt; Counter
    Counter --&gt; Ledger
    Signing --&gt; Ledger
    Ledger --&gt; Reports
    Sync --&gt; DGI
    Signing --&gt;|sealed invoice + security elements| Dashboard
    Signing --&gt;|sealed invoice + security elements| API
    Signing --&gt;|sealed invoice + security elements| SDK
    Signing --&gt;|sealed invoice + security elements| POS
    Ledger --&gt;|sealed invoice upload| Sync</code></pre>
<h2 id="failure-modes-at-the-boundary">Failure modes at the boundary<a class="headerlink" href="#failure-modes-at-the-boundary" title="Permanent link">¶</a></h2>
<ol>
<li><strong>Cloud Signing Service unavailable</strong> — Clients queue invoices locally (IndexedDB for the dashboard, SQLite for SDKs), display “Queued” indicators, and automatically retry submissions when the connection returns. The queue preserves canonical payload ordering so fiscalization resumes without duplication.</li>
<li><strong>Key rotation inside HSM</strong> — The Cloud handles key rollovers without exposing private material. Clients continue using the same API endpoints; the Cloud signs each request with the active key and surfaces rotation status through monitoring channels.</li>
<li><strong>Counter corruption or serialization violation</strong> — The Monotonic Counter Manager enforces serializable isolation in PostgreSQL, ensuring each outlet receives strictly increasing fiscal numbers. Any anomaly triggers fail-fast alerts and rejects new fiscalization until the ledger reconciles.</li>
<li><strong>DGI sync backpressure</strong> — The Sync Agent queues outbound bundles, retries with exponential backoff if the control module is slow, and surfaces errors to dashboards and webhooks so operators can intervene before compliance gaps emerge.</li>
</ol>
<h2 id="trust-assumptions-table">Trust assumptions table<a class="headerlink" href="#trust-assumptions-table" title="Permanent link">¶</a></h2>
<table>
<thead>
<tr>
<th>Assumption</th>
<th>Enforcement</th>
</tr>
</thead>
<tbody>
<tr>
<td>The Cloud Signing Service (HSM) is the only authority that issues fiscal numbers, auth codes, timestamps, and QR payloads.</td>
<td>The HSM + Monotonic Counter Manager run inside Bono Pay Cloud with serializable database isolation, and only sealed responses leave this boundary.</td>
</tr>
<tr>
<td>Canonical payloads hit the trusted zone before fiscalization and include outlet-scoping metadata plus the 14 DGI tax groups.</td>
<td>API/SDK clients serialize payloads per <code>spec/architecture-kutapay-system-1.md</code> and the Cloud rejects schema or ordering deviations before signing.</td>
</tr>
<tr>
<td>Clients may not fabricate security elements after the trusted zone responds.</td>
<td>The sealed response bundle contains every mandated element (<code>fiscal_number</code>, <code>fiscal_authority_id</code>, <code>auth_code</code>, <code>timestamp</code>, <code>qr_payload</code>); printers and auditors consume only these values.</td>
</tr>
<tr>
<td>Multi-user, multi-terminal tenants share fiscal access safely.</td>
<td>Each request includes <code>merchant_id</code>, <code>outlet_id</code>, and <code>api_key_id</code>/<code>user_id</code>, so the counter manager scopes numbering and quotas by outlet.</td>
</tr>
<tr>
<td>Audit reports originate from the hash-chained ledger, not from client caches.</td>
<td>The Report Generator queries the ledger directly (Z/X/A/audit) and exposes signed downloads via the Cloud API.</td>
</tr>
</tbody>
</table>
<h2 id="phase-3-note">Phase 3 note<a class="headerlink" href="#phase-3-note" title="Permanent link">¶</a></h2>
<p>Phase 3 introduces the optional USB Fiscal Memory device as a trust anchor for DEF-homologated merchants. When that hardware is deployed, it replaces the Cloud Signing Service for the local outlet while replicating every sealed invoice back to Bono Pay Cloud for ledger consistency and DGI sync (<code>design/docs-archive/hardware/</code>). The documentation above keeps the cloud-first story intact but flags the archived USB specs for future reference.</p>
</article>
</div>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
<script src="../../assets/javascripts/bundle.79ae519e.min.js"></script>
<script src="../../assets/mermaid-zoom.js"></script>
</body>
</html>