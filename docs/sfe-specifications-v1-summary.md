# SFE Specifications v1.0 — Enterprise Billing System Technical Requirements (DRC)

**Full title:** Technical Specifications for Enterprise Billing Systems (Système de Facturation d'Entreprise)  
**Issuing body:** DGI (Direction Générale des Impôts), Democratic Republic of Congo  
**Type:** Technical specification — defines what an SFE must do for homologation

---

## Purpose

This is the **official functional and technical specification** for certified enterprise billing systems in the DRC. It defines what an SFE must do to be approved for issuing standardized invoices.

An SFE can be software, hardware, or hybrid — but it **must integrate with DGI control modules** (MCF / e-MCF).

---

## Core Architecture (Defined by DGI)

The spec defines a layered architecture:

| Layer | Role |
|-------|------|
| **SFE** | Enterprise system used by business (creates invoices) |
| **DEF** | Electronic fiscal device (trusted authority) |
| **MCF / e-MCF** | Government control modules (verify + transmit) |
| **DGI Backend** | Central tax authority system |

**Key rule:** The SFE exchanges data with MCF. The system cannot generate an invoice without security elements from the fiscal/control layer.

---

## Mandatory Invoice Types

The SFE must support all of the following:

1. **Sale invoice** (facture de vente)
2. **Advance invoice** (facture d'avance)
3. **Credit note** (note de crédit)
4. **Export invoice** (facture d'exportation)
5. **Export credit note** (note de crédit d'exportation)

All must follow defined rules and include security elements.

---

## Tax Engine Requirements

The system must support **14 DGI-defined tax groups**, including:

- Exempt
- Standard VAT (16%)
- Special regimes
- Public financing VAT
- Customs VAT
- Specific taxes

**This is not optional.** Tax logic must be embedded, not hardcoded to a single rate.

---

## Client Classification (Mandatory)

The SFE must classify clients into categories:

| Type | Description |
|------|-------------|
| Individual | Private person |
| Company | Corporate entity |
| Commercial individual | Sole trader / merchant |
| Professional | Licensed professional |
| Embassy | Diplomatic entity |

Classification affects invoice fields and tax treatment.

---

## Mandatory Invoice Content

Every invoice must include:

- Merchant NIF (tax identification number)
- Client details and classification
- Itemized line items with quantities and prices
- VAT breakdown per tax group
- Totals (HT, TVA, TTC)
- **Device identifier** (DEF NID)
- **Security elements** (fiscal number, auth code, timestamp)
- Payment method
- Operator/cashier identifier
- **QR code** encoding verification data

---

## Security Elements (Non-Negotiable)

Every invoice must carry security elements that prove it was issued by an authorized system:

| Element | Description |
|---------|-------------|
| **Sequential fiscal number** | Device-controlled, non-resettable |
| **Device ID (DEF NID)** | Unique identifier of the fiscal device |
| **Authentication code** | Cryptographic signature generated by MCF/device |
| **Trusted timestamp** | Device-controlled date/time |
| **QR code** | Encodes verification data for inspectors/customers |

These must be **generated by the trusted fiscal layer**, never by the POS software alone.

---

## Required Reports

| Report | Purpose |
|--------|---------|
| **Z Report** | End-of-day closure — daily totals, counters |
| **X Report** | Periodic summary — session or shift totals |
| **A Report** | Article-level detail — per-product breakdown |
| **Audit export** | Full journal for inspector extraction |

---

## Offline Behavior

- The system **must still generate invoices** when offline
- Invoices must include security elements even offline
- Must **synchronize with MCF/DGI** when connectivity returns
- Offline issuance is allowed but must be secured and eventually transmitted

**Offline is normal operation, not an exception.**

---

## Invoice Mutations

- **Deletion is forbidden** — invoices cannot be removed
- **Corrections** are done via credit notes referencing the original
- **Voids** are new fiscal events, not erasures
- Full traceability must be maintained

---

## Data Integrity Requirements

The SFE must guarantee:
- **Immutability** of issued invoices
- **Secure storage** with integrity checks
- **Retention** with daily, monthly, and annual closures
- **Archiving** with legal integrity
- **Audit trail** for all modifications and corrections

---

## Integration with MCF

The SFE must:
- Exchange data with MCF / e-MCF
- Receive security elements from the control module
- Transmit invoice data for verification
- Support the MCF communication protocol

**The MCF protocol spec (endpoint, auth, schema) is not fully defined in this document** — it remains a critical open unknown.

---

## Open Unknowns (Not Defined in This Spec)

These are referenced but not detailed:

| Unknown | Impact |
|---------|--------|
| MCF/e-MCF API specification | Cannot build sync layer without it |
| Exact signature algorithm | Cannot implement device signing |
| QR code payload format | Cannot generate compliant QR codes |
| Key provisioning model | Device-generated vs DGI-issued keys |
| Device registration protocol | Activation flow undefined |
| Offline grace period | How long before upload is required |

---

## Key Implications for KutaPay

1. **Architecture is validated** — the spec confirms the SFE + DEF + MCF layered model matches your design
2. **14 tax groups are mandatory** — the tax engine cannot be simplified to a single VAT rate
3. **Client classification is required** — data model must include client type
4. **Z/X/A reports are required** — must be implemented in the device or software
5. **Security elements must come from the fiscal layer** — POS alone cannot generate valid invoices
6. **Offline issuance is explicitly allowed** — but security elements must still be present (device must generate them locally)
7. **MCF protocol is the biggest blocker** — this spec confirms it exists but does not define it
8. **Software immutability is enforced** — fiscal modules must be frozen once homologated
9. **Operator ID on every invoice** — multi-cashier payloads must include cashier/waiter identity
10. **5 invoice types required** — MVP must support all five, not just sale invoices
